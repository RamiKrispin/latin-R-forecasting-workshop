<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rami Krispin">
<meta name="dcterms.date" content="2025-11-30">

<title>Correlation Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="03_correlation_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="03_correlation_analysis_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="03_correlation_analysis_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="03_correlation_analysis_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="03_correlation_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="03_correlation_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03_correlation_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="03_correlation_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03_correlation_analysis_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="03_correlation_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03_correlation_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03_correlation_analysis_files/libs/bootstrap/bootstrap-b3b667915b355825171576a18245e128.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="03_correlation_analysis_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="03_correlation_analysis_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="03_correlation_analysis_files/libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="03_correlation_analysis_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="03_correlation_analysis_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="03_correlation_analysis_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="03_correlation_analysis_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="03_correlation_analysis_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="03_correlation_analysis_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#auto-correlation-function" id="toc-auto-correlation-function" class="nav-link active" data-scroll-target="#auto-correlation-function">Auto Correlation Function</a>
  <ul class="collapse">
  <li><a href="#correlation-analysis-for-yearly-time-series" id="toc-correlation-analysis-for-yearly-time-series" class="nav-link" data-scroll-target="#correlation-analysis-for-yearly-time-series">Correlation Analysis for Yearly Time Series</a></li>
  <li><a href="#correlation-analysis-for-monthly-time-series" id="toc-correlation-analysis-for-monthly-time-series" class="nav-link" data-scroll-target="#correlation-analysis-for-monthly-time-series">Correlation Analysis for Monthly Time Series</a></li>
  </ul></li>
  <li><a href="#lags-plots" id="toc-lags-plots" class="nav-link" data-scroll-target="#lags-plots">Lags Plots</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Correlation Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rami Krispin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>In time series analysis, correlation between a series and its previous lags is pivotal in explaining the time series variation and revealing its underlying patterns. A common example of high correlation between observations is the hourly temperature, which is highly correlated with its previous observations, as the hourly fluctuations are gradual.</p>
<p>There are many tools to explore time series correlation, and in this section, we will review the main method - the Auto Correlation Function (ACF).</p>
<section id="auto-correlation-function" class="level2">
<h2 class="anchored" data-anchor-id="auto-correlation-function">Auto Correlation Function</h2>
<p>In most cases, the lags of the series contain valuable information about the current variation of the series. The ACF measures the correlation between a series and its previous lags. It enables us to understand what lags have predictive power. Both the stats and feasts libraries provide an implementation of the ACF method, with the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/acf.html">acf</a> and <a href="https://feasts.tidyverts.org/reference/ACF.html">ACF</a> functions, respectively. Let’s load the required libraries and load ourtime series and explore its correlation:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fabletools)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"./data/ts.RData"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="correlation-analysis-for-yearly-time-series" class="level3">
<h3 class="anchored" data-anchor-id="correlation-analysis-for-yearly-time-series">Correlation Analysis for Yearly Time Series</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> ts1, <span class="at">x =</span> <span class="sc">~</span>index, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"lines"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3eaa4c82f332df9e5ff4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3eaa4c82f332df9e5ff4">{"x":{"visdat":{"1fa4c847f90":["function () ","plotlyVisDat"]},"cur_data":"1fa4c847f90","attrs":{"1fa4c847f90":{"x":{},"y":{},"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"index"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7626,7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Let’s drop the first year:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ts1 <span class="ot">&lt;-</span> ts1 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(index <span class="sc">&gt;</span> <span class="dv">1986</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> ts1, <span class="at">x =</span> <span class="sc">~</span>index, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"lines"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d3dc7de3a430bfe025b1" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d3dc7de3a430bfe025b1">{"x":{"visdat":{"1fa42eaf2350":["function () ","plotlyVisDat"]},"cur_data":"1fa42eaf2350","attrs":{"1fa42eaf2350":{"x":{},"y":{},"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"index"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We will use the <code>ACF</code> function to calculate the series autocorrelation:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>acf1 <span class="ot">&lt;-</span> ts1 <span class="sc">%&gt;%</span> <span class="fu">ACF</span>(y)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(acf1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 6 x 2 [1Y]
       lag   acf
  &lt;cf_lag&gt; &lt;dbl&gt;
1       1Y 0.917
2       2Y 0.838
3       3Y 0.764
4       4Y 0.694
5       5Y 0.625
6       6Y 0.554</code></pre>
</div>
</div>
<p>Let’s calculate the 95% confidence interval for the autocorrelation calculation:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pi_upper <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">nrow</span>(ts1))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>pi_upper</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3179481</code></pre>
</div>
</div>
<p>And let’s plot it:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>acf1 <span class="sc">|&gt;</span> <span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span> lag, <span class="at">y =</span> <span class="sc">~</span> acf, <span class="at">type =</span> <span class="st">"bar"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">add_segments</span>(<span class="at">x =</span> <span class="sc">~</span> <span class="fu">min</span>(lag), <span class="at">xend =</span> <span class="sc">~</span> <span class="fu">max</span>(lag), <span class="at">y =</span> pi_upper, <span class="at">yend =</span> pi_upper, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Upper"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add_segments</span>(<span class="at">x =</span> <span class="sc">~</span> <span class="fu">min</span>(lag), <span class="at">xend =</span> <span class="sc">~</span> <span class="fu">max</span>(lag), <span class="at">y =</span> <span class="sc">-</span> pi_upper, <span class="at">yend =</span> <span class="sc">-</span> pi_upper, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Lower"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"ACF Plot"</span>, <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Lags"</span>), <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"ACF"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-febc100ca9b876bf1f73" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-febc100ca9b876bf1f73">{"x":{"visdat":{"1fa41ee20b6c":["function () ","plotlyVisDat"]},"cur_data":"1fa41ee20b6c","attrs":{"1fa41ee20b6c":{"x":{},"y":{},"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"1fa41ee20b6c.1":{"x":{},"y":0.31794814293719936,"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","xend":{},"yend":0.31794814293719936,"mode":"lines","line":{"color":"black","dash":"dash"},"name":"Upper","inherit":true},"1fa41ee20b6c.2":{"x":{},"y":-0.31794814293719936,"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","xend":{},"yend":-0.31794814293719936,"mode":"lines","line":{"color":"black","dash":"dash"},"name":"Lower","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"ACF Plot","xaxis":{"domain":[0,1],"automargin":true,"title":"Lags"},"yaxis":{"domain":[0,1],"automargin":true,"title":"ACF"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"y":[0.91710247773309883,0.83849976629120782,0.76425428540978924,0.69380119734777512,0.62502944321160547,0.55438268694737503,0.48259450267072868,0.40796244860131731,0.33380265965041039,0.25621486855688019,0.18376408180575082,0.11231809318213684,0.045489218881449849,-0.023201864441490895,-0.082953737985981393],"showlegend":false,"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,15],"y":[0.31794814293719936,0.31794814293719936],"showlegend":false,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash"},"name":"Upper","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,15],"y":[-0.31794814293719936,-0.31794814293719936],"showlegend":false,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash"},"name":"Lower","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>What can we conclude from the ACF plot? The series has a high correlation with its recent lags (i.e., 0.91 correlation with its first lag). This is a typical behavior for time series without a seasonal component and with a clear trend. Regression the series with its first lag might yield a great predictive power, which is nothing but ARIMA model with AR process of order 1.</p>
</section>
<section id="correlation-analysis-for-monthly-time-series" class="level3">
<h3 class="anchored" data-anchor-id="correlation-analysis-for-monthly-time-series">Correlation Analysis for Monthly Time Series</h3>
<p>Le’ts repeat the process for the monthly demand for natural gas in the US:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> ts2, <span class="at">x =</span> <span class="sc">~</span>date, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"lines"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3a05bcd0901fb76cd707" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3a05bcd0901fb76cd707">{"x":{"visdat":{"1fa43e442ff5":["function () ","plotlyVisDat"]},"cur_data":"1fa43e442ff5","attrs":{"1fa43e442ff5":{"x":{},"y":{},"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2001-01-01","2001-02-01","2001-03-01","2001-04-01","2001-05-01","2001-06-01","2001-07-01","2001-08-01","2001-09-01","2001-10-01","2001-11-01","2001-12-01","2002-01-01","2002-02-01","2002-03-01","2002-04-01","2002-05-01","2002-06-01","2002-07-01","2002-08-01","2002-09-01","2002-10-01","2002-11-01","2002-12-01","2003-01-01","2003-02-01","2003-03-01","2003-04-01","2003-05-01","2003-06-01","2003-07-01","2003-08-01","2003-09-01","2003-10-01","2003-11-01","2003-12-01","2004-01-01","2004-02-01","2004-03-01","2004-04-01","2004-05-01","2004-06-01","2004-07-01","2004-08-01","2004-09-01","2004-10-01","2004-11-01","2004-12-01","2005-01-01","2005-02-01","2005-03-01","2005-04-01","2005-05-01","2005-06-01","2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01","2025-02-01","2025-03-01","2025-04-01","2025-05-01","2025-06-01","2025-07-01","2025-08-01","2025-09-01"],"y":[2505011,2156873,2086568,1663832,1385163,1313119,1459919,1528483,1360871,1507428,1561970,1965873,2319273,2090786,2096915,1734549,1470504,1453967,1602849,1582079,1408599,1506936,1766395,2214167,2532736,2346489,2041522,1603853,1379497,1240196,1464704,1512522,1299128,1417234,1616154,2108690,2512844,2358946,1952607,1609746,1441557,1356266,1452339,1445892,1357712,1426546,1647979,2176020,2396713,2094357,2048169,1585188,1386917,1400018,1547608,1555887,1301829,1302758,1529693,2169754,2010926,1999359,1972165,1543302,1390353,1415134,1615241,1607830,1328565,1501925,1622364,1965718,2306943,2403778,1967388,1662412,1414428,1413254,1513157,1741755,1446674,1479110,1681149,2225994,2554281,2335770,2109623,1672724,1430242,1459015,1556011,1531863,1329726,1488645,1714971,2226478,2538368,2162215,1996245,1585512,1353150,1378772,1503321,1578354,1427135,1510867,1619852,2310875,2624217,2312746,1974222,1540128,1465089,1500962,1668244,1718550,1485061,1506234,1809151,2522442,2699039,2285465,2056105,1665278,1509295,1503845,1728010,1727907,1500242,1579772,1860159,2351937,2557465,2319221,1949890,1784460,1703507,1702557,1891318,1832775,1640347,1727393,1989660,2312832,2661816,2371983,2316191,1783603,1572373,1567216,1738157,1739436,1588718,1680814,2118508,2700111,2997145,2556038,2365293,1786764,1636202,1576508,1701744,1751644,1635485,1730740,2167984,2475535,2903574,2730693,2392542,1826933,1678755,1723906,1882675,1867936,1723960,1804380,2064029,2389902,2880714,2459545,2164467,1903501,1785885,1825125,2001036,2023229,1774412,1748897,1979957,2665391,2708217,2161185,2324198,1753578,1710548,1731387,1950510,1904112,1737701,1838965,2155805,2858509,3107734,2507085,2576005,2148089,1855856,1867447,2139037,2100482,1949898,2069201,2488282,2759042,3161732,2783640,2680848,1994279,1912779,1902995,2162450,2197474,1982049,2072599,2535754,2904407,3052335,2809540,2475096,2035122,1861283,1917555,2234989,2173203,1938029,2093493,2215375,2924939,3056278,2850394,2387023,2036708,1882870,2008918,2171329,2188822,1906377,2015381,2427617,2731775,3287895,2793006,2516726,2114010,1995895,2074067,2329216,2306262,2047010,2108275,2502928,3084994,3030057,2702018,2743975,2176612,2065968,2118628,2404122,2409018,2128961,2186224,2558279,2885437,3423098,2698883,2529429,2151137,2087577,2176896,2471981,2453624,2164696,2175522,2445484,3065386,3605812,2960920,2482984,2123687,2050025,2158141,2441338,2367094,2162772],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Next, we will calculate the ACF for the series</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>acf2 <span class="ot">&lt;-</span> ts2 <span class="sc">|&gt;</span> <span class="fu">ACF</span>(y, <span class="at">lag_max =</span> <span class="dv">60</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>pi_upper <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">nrow</span>(ts2))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>pi_upper</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1137286</code></pre>
</div>
</div>
<p>And plot the ACF for the series:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>acf2 <span class="sc">|&gt;</span> <span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span> lag, <span class="at">y =</span> <span class="sc">~</span> acf, <span class="at">type =</span> <span class="st">"bar"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">add_segments</span>(<span class="at">x =</span> <span class="sc">~</span> <span class="fu">min</span>(lag), <span class="at">xend =</span> <span class="sc">~</span> <span class="fu">max</span>(lag), <span class="at">y =</span> pi_upper, <span class="at">yend =</span> pi_upper, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Upper"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add_segments</span>(<span class="at">x =</span> <span class="sc">~</span> <span class="fu">min</span>(lag), <span class="at">xend =</span> <span class="sc">~</span> <span class="fu">max</span>(lag), <span class="at">y =</span> <span class="sc">-</span> pi_upper, <span class="at">yend =</span> <span class="sc">-</span> pi_upper, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Lower"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"ACF Plot"</span>, <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Lags"</span>), <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"ACF"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f1f0ba58553335618095" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f1f0ba58553335618095">{"x":{"visdat":{"1fa41845913":["function () ","plotlyVisDat"]},"cur_data":"1fa41845913","attrs":{"1fa41845913":{"x":{},"y":{},"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"1fa41845913.1":{"x":{},"y":0.1137286453954407,"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","xend":{},"yend":0.1137286453954407,"mode":"lines","line":{"color":"black","dash":"dash"},"name":"Upper","inherit":true},"1fa41845913.2":{"x":{},"y":-0.1137286453954407,"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","xend":{},"yend":-0.1137286453954407,"mode":"lines","line":{"color":"black","dash":"dash"},"name":"Lower","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"ACF Plot","xaxis":{"domain":[0,1],"automargin":true,"title":"Lags"},"yaxis":{"domain":[0,1],"automargin":true,"title":"ACF"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[0.80814411678808784,0.48241187019691112,0.18470939195392155,0.046916451207423514,0.040281041165160028,0.050242858739087626,0.036081833402092624,0.033656089316120165,0.16138414656283417,0.44622990473015633,0.75000752291408135,0.89732415867994264,0.73333754278565011,0.42751795967606776,0.14219599488729401,0.015457043430559755,0.012654200229022496,0.021374494872387306,0.0098872245141753707,0.01159577023323235,0.13783867350557147,0.41399967162283524,0.6970317295582138,0.82681269440462568,0.67044047885841263,0.37693396049451894,0.10741369173998358,-0.011441447713282421,-0.010652211960272535,-0.003900360309360462,-0.014870844209610249,-0.01390226033255422,0.10972394146642993,0.37026100152269958,0.64181348202390331,0.76748858224706928,0.61192016794658943,0.32534481077366301,0.071671912195246046,-0.040725120848790632,-0.041177065146808696,-0.032630675174270769,-0.042901762602512029,-0.040840925887261868,0.082555839137651771,0.33315721563672029,0.59045482023356632,0.70958101031000498,0.56003922151863017,0.2866187670631607,0.039703969154443138,-0.067333837713456177,-0.065220094186360211,-0.058398923673284267,-0.068929716675160332,-0.059108879688779016,0.056402592770342867,0.29610584562253545,0.53679135470852124,0.64302878228240701],"showlegend":false,"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,60],"y":[0.1137286453954407,0.1137286453954407],"showlegend":false,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash"},"name":"Upper","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,60],"y":[-0.1137286453954407,-0.1137286453954407],"showlegend":false,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash"},"name":"Lower","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can learn from the above output that the series has strong seasonal patterns and the first seasonal lag is the most significant. Potential regression to consider is - regression the series with lags 1, 12, and 24, which is seasonal ARIMA model with AR order 1 and seasonal AR order of 1 or 2 (depends if using lags 12 and 24).</p>
<p>A more elegant way to plot the ACF output would be to highlight the seasonal lags. Let’s functionalize the process and replot it:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_acf <span class="ot">&lt;-</span> <span class="cf">function</span>(ts, var, lag_max, frequency){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> ts <span class="sc">|&gt;</span> feasts<span class="sc">::</span><span class="fu">ACF</span>(<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(var), <span class="at">lag_max =</span> lag_max)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    color <span class="ot">&lt;-</span> <span class="st">"#0072B5"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    pi_upper <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">nrow</span>(ts))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>pi_upper</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">"bar"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(frequency)){</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        s <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> frequency, <span class="at">by =</span> frequency, <span class="at">to =</span> <span class="fu">nrow</span>(a))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        a<span class="sc">$</span>seasonal <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        a<span class="sc">$</span>non_seasonal <span class="ot">&lt;-</span> a<span class="sc">$</span>acf</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        a<span class="sc">$</span>non_seasonal[s] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        a<span class="sc">$</span>seasonal[s] <span class="ot">&lt;-</span> a<span class="sc">$</span>acf[s]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span> plotly<span class="sc">::</span><span class="fu">add_trace</span>(<span class="at">x =</span> a<span class="sc">$</span>lag, <span class="at">y =</span> a<span class="sc">$</span>non_seasonal, <span class="at">name =</span> <span class="st">"Non-seasonal"</span>, <span class="at">marker =</span>  <span class="fu">list</span>(<span class="at">color =</span> color,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"rgb(8,48,107)"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">width =</span> <span class="fl">1.5</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                                  plotly<span class="sc">::</span><span class="fu">add_trace</span>(<span class="at">x =</span> a<span class="sc">$</span>lag, <span class="at">y =</span> a<span class="sc">$</span>seasonal, <span class="at">name =</span> <span class="st">"Seasonal"</span>, <span class="at">marker =</span>  <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"rgb(8,48,107)"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">width =</span> <span class="fl">1.5</span>)))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span> plotly<span class="sc">::</span><span class="fu">add_trace</span>(<span class="at">x =</span> a<span class="sc">$</span>lag, <span class="at">y =</span> a<span class="sc">$</span>acf, <span class="at">name =</span> <span class="st">"Lags"</span>, <span class="at">marker =</span>  <span class="fu">list</span>(<span class="at">color =</span> color,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"rgb(8,48,107)"</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">width =</span> <span class="fl">1.5</span>)))</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">|&gt;</span> plotly<span class="sc">::</span><span class="fu">layout</span>(<span class="st">"ACF Plot"</span>, <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"ACF"</span>), <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Lags"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>     plotly<span class="sc">::</span><span class="fu">add_segments</span>(<span class="at">x =</span> <span class="sc">~</span> <span class="fu">min</span>(a<span class="sc">$</span>lag), <span class="at">xend =</span> <span class="sc">~</span> <span class="fu">max</span>(a<span class="sc">$</span>lag), <span class="at">y =</span> pi_upper, <span class="at">yend =</span> pi_upper, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"95% CI"</span>, <span class="at">showlegend =</span> <span class="cn">TRUE</span>, <span class="at">legendgroup =</span> <span class="st">"ci"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    plotly<span class="sc">::</span><span class="fu">add_segments</span>(<span class="at">x =</span> <span class="sc">~</span> <span class="fu">min</span>(a<span class="sc">$</span>lag), <span class="at">xend =</span> <span class="sc">~</span> <span class="fu">max</span>(a<span class="sc">$</span>lag), <span class="at">y =</span> <span class="sc">-</span> pi_upper, <span class="at">yend =</span> <span class="sc">-</span> pi_upper, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"95% CI"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>, <span class="at">legendgroup =</span> <span class="st">"ci"</span>) </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_acf</span>(<span class="at">ts =</span> ts2, <span class="at">var =</span> <span class="st">"y"</span>, <span class="at">lag_max =</span> <span class="dv">60</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-457d4ebc4c0a6b847087" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-457d4ebc4c0a6b847087">{"x":{"visdat":{"1fa457593db4":["function () ","plotlyVisDat"]},"cur_data":"1fa457593db4","attrs":{"1fa457593db4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"1fa457593db4.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar","x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[0.80814411678808784,0.48241187019691112,0.18470939195392155,0.046916451207423514,0.040281041165160028,0.050242858739087626,0.036081833402092624,0.033656089316120165,0.16138414656283417,0.44622990473015633,0.75000752291408135,null,0.73333754278565011,0.42751795967606776,0.14219599488729401,0.015457043430559755,0.012654200229022496,0.021374494872387306,0.0098872245141753707,0.01159577023323235,0.13783867350557147,0.41399967162283524,0.6970317295582138,null,0.67044047885841263,0.37693396049451894,0.10741369173998358,-0.011441447713282421,-0.010652211960272535,-0.003900360309360462,-0.014870844209610249,-0.01390226033255422,0.10972394146642993,0.37026100152269958,0.64181348202390331,null,0.61192016794658943,0.32534481077366301,0.071671912195246046,-0.040725120848790632,-0.041177065146808696,-0.032630675174270769,-0.042901762602512029,-0.040840925887261868,0.082555839137651771,0.33315721563672029,0.59045482023356632,null,0.56003922151863017,0.2866187670631607,0.039703969154443138,-0.067333837713456177,-0.065220094186360211,-0.058398923673284267,-0.068929716675160332,-0.059108879688779016,0.056402592770342867,0.29610584562253545,0.53679135470852124,null],"name":"Non-seasonal","marker":{"color":"#0072B5","line":{"color":"rgb(8,48,107)","width":1.5}},"inherit":true},"1fa457593db4.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar","x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[null,null,null,null,null,null,null,null,null,null,null,0.89732415867994264,null,null,null,null,null,null,null,null,null,null,null,0.82681269440462568,null,null,null,null,null,null,null,null,null,null,null,0.76748858224706928,null,null,null,null,null,null,null,null,null,null,null,0.70958101031000498,null,null,null,null,null,null,null,null,null,null,null,0.64302878228240701],"name":"Seasonal","marker":{"color":"red","line":{"color":"rgb(8,48,107)","width":1.5}},"inherit":true},"1fa457593db4.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","x":{},"y":0.1137286453954407,"xend":{},"yend":0.1137286453954407,"mode":"lines","line":{"color":"black","dash":"dash"},"name":"95% CI","showlegend":true,"legendgroup":"ci","inherit":true},"1fa457593db4.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","x":{},"y":-0.1137286453954407,"xend":{},"yend":-0.1137286453954407,"mode":"lines","line":{"color":"black","dash":"dash"},"name":"95% CI","showlegend":false,"legendgroup":"ci","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"yaxis":{"domain":[0,1],"automargin":true,"title":"ACF"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Lags"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"bar","x":[1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,25,26,27,28,29,30,31,32,33,34,35,37,38,39,40,41,42,43,44,45,46,47,49,50,51,52,53,54,55,56,57,58,59],"y":[0.80814411678808784,0.48241187019691112,0.18470939195392155,0.046916451207423514,0.040281041165160028,0.050242858739087626,0.036081833402092624,0.033656089316120165,0.16138414656283417,0.44622990473015633,0.75000752291408135,0.73333754278565011,0.42751795967606776,0.14219599488729401,0.015457043430559755,0.012654200229022496,0.021374494872387306,0.0098872245141753707,0.01159577023323235,0.13783867350557147,0.41399967162283524,0.6970317295582138,0.67044047885841263,0.37693396049451894,0.10741369173998358,-0.011441447713282421,-0.010652211960272535,-0.003900360309360462,-0.014870844209610249,-0.01390226033255422,0.10972394146642993,0.37026100152269958,0.64181348202390331,0.61192016794658943,0.32534481077366301,0.071671912195246046,-0.040725120848790632,-0.041177065146808696,-0.032630675174270769,-0.042901762602512029,-0.040840925887261868,0.082555839137651771,0.33315721563672029,0.59045482023356632,0.56003922151863017,0.2866187670631607,0.039703969154443138,-0.067333837713456177,-0.065220094186360211,-0.058398923673284267,-0.068929716675160332,-0.059108879688779016,0.056402592770342867,0.29610584562253545,0.53679135470852124],"name":"Non-seasonal","marker":{"color":"#0072B5","line":{"color":"rgb(8,48,107)","width":1.5}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"bar","x":[12,24,36,48,60],"y":[0.89732415867994264,0.82681269440462568,0.76748858224706928,0.70958101031000498,0.64302878228240701],"name":"Seasonal","marker":{"color":"red","line":{"color":"rgb(8,48,107)","width":1.5}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","x":[1,60],"y":[0.1137286453954407,0.1137286453954407],"mode":"lines","line":{"color":"black","dash":"dash"},"name":"95% CI","showlegend":true,"legendgroup":"ci","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"type":"scatter","x":[1,60],"y":[-0.1137286453954407,-0.1137286453954407],"mode":"lines","line":{"color":"black","dash":"dash"},"name":"95% CI","showlegend":false,"legendgroup":"ci","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="lags-plots" class="level2">
<h2 class="anchored" data-anchor-id="lags-plots">Lags Plots</h2>
<p>Another common way to visualize correlation of the series with its lags is using lags plots. The following code generates a plot for each lag:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plot_lag <span class="ot">&lt;-</span> <span class="cf">function</span>(ts, var, lag){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> ts <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lag =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(<span class="at">x=</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(var), <span class="at">n =</span> lag))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the regression formula</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(var, <span class="st">"~ lag"</span> ))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the linear model</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> d)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract model coefficients</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  intercept <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="dv">1</span>]</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  slope <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="dv">2</span>]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format regression formula text</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  reg_formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"y = "</span>, <span class="fu">round</span>(intercept, <span class="dv">2</span>),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(slope <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">" - "</span>, <span class="st">" + "</span>),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">abs</span>(<span class="fu">round</span>(slope, <span class="dv">2</span>)), <span class="fu">paste</span>(<span class="st">"*lag"</span>, lag, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get adjusted R-squared</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  adj_r2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>adj.r.squared</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  adj_r2_label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Adjusted R² = "</span>, <span class="fu">round</span>(adj_r2, <span class="dv">3</span>))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add predicted values to data</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  d<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> d)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plot</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(d, <span class="at">x =</span> <span class="sc">~</span> lag, <span class="at">y =</span> <span class="sc">~</span><span class="fu">get</span>(var), <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">name =</span> <span class="st">'Actual'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> lag, <span class="at">y =</span> <span class="sc">~</span>predicted, <span class="at">name =</span> <span class="st">'Regression Fitted Line'</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">title =</span> <span class="fu">paste</span>(var, <span class="st">"vs Lag"</span>, lag, <span class="at">sep =</span> <span class="st">" "</span>),</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Lag"</span>, lag, <span class="at">sep =</span> <span class="st">" "</span>)),</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> var),</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">annotations =</span> <span class="fu">list</span>(</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.95</span>, <span class="at">xref =</span> <span class="st">"paper"</span>, <span class="at">yref =</span> <span class="st">"paper"</span>,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">text =</span> reg_formula,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>)),</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>             <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.88</span>, <span class="at">xref =</span> <span class="st">"paper"</span>, <span class="at">yref =</span> <span class="st">"paper"</span>,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">text =</span> adj_r2_label,</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>           ))</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s plot the relationship between the total number of consumers of natural gas in the US with its first and 10th lags:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_lag</span>(<span class="at">ts =</span> ts1, <span class="at">var =</span> <span class="st">"y"</span>, <span class="at">lag =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ab95d112aacf19626154" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ab95d112aacf19626154">{"x":{"visdat":{"1fa48b80691":["function () ","plotlyVisDat"]},"cur_data":"1fa48b80691","attrs":{"1fa48b80691":{"x":{},"y":{},"mode":"markers","name":"Actual","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"1fa48b80691.1":{"x":{},"y":{},"mode":"lines","name":"Regression Fitted Line","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"color":"red","dash":"dash"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"y vs Lag 1","xaxis":{"domain":[0,1],"automargin":true,"title":"Lag 1"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"annotations":[{"x":0.050000000000000003,"y":0.94999999999999996,"xref":"paper","yref":"paper","text":"y = 379967.07 + 0.97*lag1","showarrow":false,"font":{"size":12}},{"x":0.050000000000000003,"y":0.88,"xref":"paper","yref":"paper","text":"Adjusted R² = 0.997","showarrow":false,"font":{"size":12}}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812],"y":[8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"mode":"markers","name":"Actual","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10510950,10515162,10542584,10625190,10681916,10754908,10781720,10916368,10969597,11004853,11025789,11112094,11186350,11232552,11280329,11359812],"y":[8057863.7157365112,8260062.6435144059,8455041.0135474075,8633828.0064473227,8766822.6378405485,8811345.525447242,8855611.0216358025,8918303.8007859048,8990963.9411921427,9091751.6215142198,9180299.1257936358,9298266.9548097774,9443258.9401530866,9481713.2180220746,9707367.7886546142,9827341.3281554487,9901809.036218835,10051485.545372153,10213711.100269893,10412622.216914285,10519460.052495031,10589130.567297449,10593221.6339132,10619856.303603873,10700090.550721796,10755187.854816066,10826084.135541819,10852126.3193266,10982908.355812257,11034609.064475549,11068852.807259239,11089187.700580074,11173014.743379779,11245138.732605604,11290014.197890719,11336419.442359075,11413620.355896518],"mode":"lines","name":"Regression Fitted Line","type":"scatter","line":{"color":"red","dash":"dash"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_lag</span>(<span class="at">ts =</span> ts1, <span class="at">var =</span> <span class="st">"y"</span>, <span class="at">lag =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f59f0ac62069c874da64" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f59f0ac62069c874da64">{"x":{"visdat":{"1fa4fb696fd":["function () ","plotlyVisDat"]},"cur_data":"1fa4fb696fd","attrs":{"1fa4fb696fd":{"x":{},"y":{},"mode":"markers","name":"Actual","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"1fa4fb696fd.1":{"x":{},"y":{},"mode":"lines","name":"Regression Fitted Line","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"color":"red","dash":"dash"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"y vs Lag 10","xaxis":{"domain":[0,1],"automargin":true,"title":"Lag 10"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"annotations":[{"x":0.050000000000000003,"y":0.94999999999999996,"xref":"paper","yref":"paper","text":"y = 3178842.21 + 0.76*lag10","showarrow":false,"font":{"size":12}},{"x":0.050000000000000003,"y":0.88,"xref":"paper","yref":"paper","text":"Adjusted R² = 0.94","showarrow":false,"font":{"size":12}}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720],"y":[9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"mode":"markers","name":"Actual","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10510950,10515162,10542584,10625190,10681916,10754908,10781720],"y":[9217727.944450032,9376763.1955735125,9530119.2711106986,9670740.3645354994,9775344.4533609804,9810362.9803585652,9845179.0616297089,9894488.7290218007,9951638.0116770789,10030910.410528675,10100555.560155299,10193340.638287274,10307380.989803351,10337626.381333737,10515110.167732084,10609472.79463803,10668043.781055225,10785768.64479254,10913363.69262656,11069812.986074548,11153844.00541673,11208641.861860735,11211859.602991952,11232808.533974908,11295915.068610536,11339250.677207254,11395012.633676803,11415495.557515876],"mode":"lines","name":"Regression Fitted Line","type":"scatter","line":{"color":"red","dash":"dash"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Likewise, we will plot the relationship between the demand for natural gas in the US with its first and seasonal lag (12):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_lag</span>(<span class="at">ts =</span> ts2, <span class="at">var =</span> <span class="st">"y"</span>, <span class="at">lag =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f9253552781eb6b17b74" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f9253552781eb6b17b74">{"x":{"visdat":{"1fa475cc159a":["function () ","plotlyVisDat"]},"cur_data":"1fa475cc159a","attrs":{"1fa475cc159a":{"x":{},"y":{},"mode":"markers","name":"Actual","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"1fa475cc159a.1":{"x":{},"y":{},"mode":"lines","name":"Regression Fitted Line","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"color":"red","dash":"dash"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"y vs Lag 1","xaxis":{"domain":[0,1],"automargin":true,"title":"Lag 1"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"annotations":[{"x":0.050000000000000003,"y":0.94999999999999996,"xref":"paper","yref":"paper","text":"y = 386004.21 + 0.81*lag1","showarrow":false,"font":{"size":12}},{"x":0.050000000000000003,"y":0.88,"xref":"paper","yref":"paper","text":"Adjusted R² = 0.654","showarrow":false,"font":{"size":12}}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2505011,2156873,2086568,1663832,1385163,1313119,1459919,1528483,1360871,1507428,1561970,1965873,2319273,2090786,2096915,1734549,1470504,1453967,1602849,1582079,1408599,1506936,1766395,2214167,2532736,2346489,2041522,1603853,1379497,1240196,1464704,1512522,1299128,1417234,1616154,2108690,2512844,2358946,1952607,1609746,1441557,1356266,1452339,1445892,1357712,1426546,1647979,2176020,2396713,2094357,2048169,1585188,1386917,1400018,1547608,1555887,1301829,1302758,1529693,2169754,2010926,1999359,1972165,1543302,1390353,1415134,1615241,1607830,1328565,1501925,1622364,1965718,2306943,2403778,1967388,1662412,1414428,1413254,1513157,1741755,1446674,1479110,1681149,2225994,2554281,2335770,2109623,1672724,1430242,1459015,1556011,1531863,1329726,1488645,1714971,2226478,2538368,2162215,1996245,1585512,1353150,1378772,1503321,1578354,1427135,1510867,1619852,2310875,2624217,2312746,1974222,1540128,1465089,1500962,1668244,1718550,1485061,1506234,1809151,2522442,2699039,2285465,2056105,1665278,1509295,1503845,1728010,1727907,1500242,1579772,1860159,2351937,2557465,2319221,1949890,1784460,1703507,1702557,1891318,1832775,1640347,1727393,1989660,2312832,2661816,2371983,2316191,1783603,1572373,1567216,1738157,1739436,1588718,1680814,2118508,2700111,2997145,2556038,2365293,1786764,1636202,1576508,1701744,1751644,1635485,1730740,2167984,2475535,2903574,2730693,2392542,1826933,1678755,1723906,1882675,1867936,1723960,1804380,2064029,2389902,2880714,2459545,2164467,1903501,1785885,1825125,2001036,2023229,1774412,1748897,1979957,2665391,2708217,2161185,2324198,1753578,1710548,1731387,1950510,1904112,1737701,1838965,2155805,2858509,3107734,2507085,2576005,2148089,1855856,1867447,2139037,2100482,1949898,2069201,2488282,2759042,3161732,2783640,2680848,1994279,1912779,1902995,2162450,2197474,1982049,2072599,2535754,2904407,3052335,2809540,2475096,2035122,1861283,1917555,2234989,2173203,1938029,2093493,2215375,2924939,3056278,2850394,2387023,2036708,1882870,2008918,2171329,2188822,1906377,2015381,2427617,2731775,3287895,2793006,2516726,2114010,1995895,2074067,2329216,2306262,2047010,2108275,2502928,3084994,3030057,2702018,2743975,2176612,2065968,2118628,2404122,2409018,2128961,2186224,2558279,2885437,3423098,2698883,2529429,2151137,2087577,2176896,2471981,2453624,2164696,2175522,2445484,3065386,3605812,2960920,2482984,2123687,2050025,2158141,2441338,2367094],"y":[2156873,2086568,1663832,1385163,1313119,1459919,1528483,1360871,1507428,1561970,1965873,2319273,2090786,2096915,1734549,1470504,1453967,1602849,1582079,1408599,1506936,1766395,2214167,2532736,2346489,2041522,1603853,1379497,1240196,1464704,1512522,1299128,1417234,1616154,2108690,2512844,2358946,1952607,1609746,1441557,1356266,1452339,1445892,1357712,1426546,1647979,2176020,2396713,2094357,2048169,1585188,1386917,1400018,1547608,1555887,1301829,1302758,1529693,2169754,2010926,1999359,1972165,1543302,1390353,1415134,1615241,1607830,1328565,1501925,1622364,1965718,2306943,2403778,1967388,1662412,1414428,1413254,1513157,1741755,1446674,1479110,1681149,2225994,2554281,2335770,2109623,1672724,1430242,1459015,1556011,1531863,1329726,1488645,1714971,2226478,2538368,2162215,1996245,1585512,1353150,1378772,1503321,1578354,1427135,1510867,1619852,2310875,2624217,2312746,1974222,1540128,1465089,1500962,1668244,1718550,1485061,1506234,1809151,2522442,2699039,2285465,2056105,1665278,1509295,1503845,1728010,1727907,1500242,1579772,1860159,2351937,2557465,2319221,1949890,1784460,1703507,1702557,1891318,1832775,1640347,1727393,1989660,2312832,2661816,2371983,2316191,1783603,1572373,1567216,1738157,1739436,1588718,1680814,2118508,2700111,2997145,2556038,2365293,1786764,1636202,1576508,1701744,1751644,1635485,1730740,2167984,2475535,2903574,2730693,2392542,1826933,1678755,1723906,1882675,1867936,1723960,1804380,2064029,2389902,2880714,2459545,2164467,1903501,1785885,1825125,2001036,2023229,1774412,1748897,1979957,2665391,2708217,2161185,2324198,1753578,1710548,1731387,1950510,1904112,1737701,1838965,2155805,2858509,3107734,2507085,2576005,2148089,1855856,1867447,2139037,2100482,1949898,2069201,2488282,2759042,3161732,2783640,2680848,1994279,1912779,1902995,2162450,2197474,1982049,2072599,2535754,2904407,3052335,2809540,2475096,2035122,1861283,1917555,2234989,2173203,1938029,2093493,2215375,2924939,3056278,2850394,2387023,2036708,1882870,2008918,2171329,2188822,1906377,2015381,2427617,2731775,3287895,2793006,2516726,2114010,1995895,2074067,2329216,2306262,2047010,2108275,2502928,3084994,3030057,2702018,2743975,2176612,2065968,2118628,2404122,2409018,2128961,2186224,2558279,2885437,3423098,2698883,2529429,2151137,2087577,2176896,2471981,2453624,2164696,2175522,2445484,3065386,3605812,2960920,2482984,2123687,2050025,2158141,2441338,2367094,2162772],"mode":"markers","name":"Actual","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1240196,1299128,1301829,1302758,1313119,1328565,1329726,1353150,1356266,1357712,1360871,1378772,1379497,1385163,1386917,1390353,1400018,1408599,1413254,1414428,1415134,1417234,1426546,1427135,1430242,1441557,1445892,1446674,1452339,1453967,1459015,1459919,1464704,1465089,1470504,1479110,1485061,1488645,1500242,1500962,1501925,1503321,1503845,1506234,1506936,1507428,1509295,1510867,1512522,1513157,1528483,1529693,1531863,1540128,1543302,1547608,1555887,1556011,1561970,1567216,1572373,1576508,1578354,1579772,1582079,1585188,1585512,1588718,1602849,1603853,1607830,1609746,1615241,1616154,1619852,1622364,1635485,1636202,1640347,1647979,1662412,1663832,1665278,1668244,1672724,1678755,1680814,1681149,1701744,1702557,1703507,1710548,1714971,1718550,1723906,1723960,1727393,1727907,1728010,1730740,1731387,1734549,1737701,1738157,1739436,1741755,1748897,1751644,1753578,1766395,1774412,1783603,1784460,1785885,1786764,1804380,1809151,1825125,1826933,1832775,1838965,1855856,1860159,1861283,1867447,1867936,1882675,1882870,1891318,1902995,1903501,1904112,1906377,1912779,1917555,1938029,1949890,1949898,1950510,1952607,1965718,1965873,1967388,1972165,1974222,1979957,1982049,1989660,1994279,1995895,1996245,1999359,2001036,2008918,2010926,2015381,2023229,2035122,2036708,2041522,2047010,2048169,2050025,2056105,2064029,2065968,2069201,2072599,2074067,2086568,2087577,2090786,2093493,2094357,2096915,2100482,2108275,2108690,2109623,2114010,2118508,2118628,2123687,2128961,2139037,2148089,2151137,2155805,2156873,2158141,2161185,2162215,2162450,2164467,2164696,2167984,2169754,2171329,2173203,2175522,2176020,2176612,2176896,2186224,2188822,2197474,2214167,2215375,2225994,2226478,2234989,2285465,2306262,2306943,2310875,2312746,2312832,2316191,2319221,2319273,2324198,2329216,2335770,2346489,2351937,2358946,2365293,2367094,2371983,2387023,2389902,2392542,2396713,2403778,2404122,2409018,2427617,2441338,2445484,2453624,2459545,2471981,2475096,2475535,2482984,2488282,2502928,2505011,2507085,2512844,2516726,2522442,2529429,2532736,2535754,2538368,2554281,2556038,2557465,2558279,2576005,2624217,2661816,2665391,2680848,2698883,2699039,2700111,2702018,2708217,2730693,2731775,2743975,2759042,2783640,2793006,2809540,2850394,2858509,2880714,2885437,2903574,2904407,2924939,2960920,2997145,3030057,3052335,3056278,3065386,3084994,3107734,3161732,3287895,3423098,3605812],"y":[1388564.8855282867,1436204.8601644074,1438388.3185824512,1439139.3118702569,1447515.0292598729,1460001.404204377,1460939.9437169088,1479875.6453030843,1482394.5851144968,1483563.5154634384,1486117.2159975371,1500588.1856907629,1501174.2676430333,1505754.5991486374,1507172.5132786813,1509950.1375379923,1517763.2162534287,1524700.001401609,1528463.0517296335,1529412.1002978613,1529982.8228610374,1531680.4395503718,1539208.1569842203,1539684.2980461337,1542195.9623574489,1551342.8827573624,1554847.2486374883,1555479.4087570405,1560058.9318737448,1561374.9890024289,1565455.7361680288,1566186.5197333423,1570054.6606183257,1570365.8903447036,1574743.3162364871,1581700.3111071594,1586511.0334491732,1589408.2992656371,1598783.1853352613,1599365.2253430332,1600143.7038534279,1601272.2147573854,1601695.8105408193,1603627.0516221621,1604194.5406297396,1604592.2679683836,1606101.5300440919,1607372.3173943935,1608710.2010233691,1609223.5279746677,1621612.89625121,1622591.0468198264,1624345.2507321385,1631026.584988019,1633592.4113556128,1637073.3339576479,1643765.9856581239,1643866.2258816846,1648683.4153348957,1652924.2235026329,1657093.0850582984,1660435.7731584876,1661928.0590673026,1663074.3545270532,1664939.3077186218,1667452.5888077365,1667714.5068112337,1670306.2016236174,1681729.5451650384,1682541.1676203203,1685756.1302743596,1687305.0034061524,1691747.1004099105,1692485.1594753212,1695474.5816263491,1697505.2545423529,1708112.125295094,1708691.7401361668,1712042.5121253529,1718212.1362077338,1729879.6131968591,1731027.525434409,1732196.4557833506,1734594.1372598105,1738215.7195303906,1743091.1129843791,1744755.5857288262,1745026.3960102201,1761675.1653991921,1762332.3855746347,1763100.3550293334,1768792.2212720017,1772367.7253752998,1775260.9492472652,1779590.6801939677,1779634.3331945506,1782409.5322871625,1782825.0441815995,1782908.3082382667,1785115.2099344016,1785638.2375524964,1788194.3632532943,1790742.4050650951,1791111.0304033507,1792144.9598060453,1794019.6136644101,1799793.1271859463,1802013.7714933758,1803577.1956253627,1813938.3161526001,1820419.1699613591,1827849.0723383459,1828541.8616253741,1829693.8158074224,1830404.3896502438,1844644.9685070603,1848501.7919474479,1861414.9962309848,1862876.5633616117,1867599.1713135601,1872603.0986025981,1886257.5955071442,1889736.0929424802,1890644.722065724,1895627.6312433702,1896022.9334153151,1907937.7774077435,1908095.4132431815,1914924.6826677038,1924364.2398493027,1924773.2846325424,1925267.2102502487,1927098.2111080308,1932273.5168438016,1936134.3822286876,1952685.3365607981,1962273.6372999386,1962280.1044111361,1962774.8384177422,1964470.0299403775,1975068.8168041217,1975194.1170835725,1976418.8262665924,1980280.5000403782,1981943.3560070263,1986579.4663467086,1988270.6159248454,1994423.2638403329,1998157.212167969,1999463.5686298567,1999746.5047447458,2002263.8277783587,2003619.4959631271,2009991.2172704288,2011614.4621809924,2015215.8347290803,2021560.0708137928,2031174.2399977231,2032456.3447926205,2036347.9289556944,2040784.3672371551,2041721.2899718876,2043221.6597696994,2048136.6642797722,2054542.3379208606,2056109.803997346,2058723.3253100212,2061470.2307911443,2062656.9456958789,2072762.6153308165,2073578.2797305968,2076172.3997096797,2078360.7084611217,2079059.1564704478,2081127.0152758369,2084010.5384810062,2090310.3131762361,2090645.7945696046,2091400.0214130089,2094946.4235159184,2098582.5567866927,2098679.5634546545,2102769.2028981512,2107032.6459550792,2115177.9725082857,2122495.5088282167,2124959.4781944505,2128733.0375781707,2129596.3969230321,2130621.4340478303,2133082.1698584654,2133914.810425139,2134104.7818165645,2135735.3022272252,2135920.4232852529,2138578.4059874103,2140009.2543398496,2141282.4668568503,2142797.3876548563,2144672.0415132213,2145074.6191852633,2145553.1854138756,2145782.7678613858,2153323.4195176288,2155423.6138790054,2162417.7946390631,2175912.2305414723,2176888.7643322893,2185473.0460580233,2185864.3062854698,2192744.5042106723,2233548.742311073,2250360.8062577811,2250911.3190984656,2254089.9042520192,2255602.3998833261,2255671.9213286988,2258387.2996427342,2260836.7180087739,2260878.7542315573,2264860.0695624962,2268916.5650611054,2274214.7459096285,2282879.8665253306,2287283.9692508038,2292949.9670486823,2298080.8113949704,2299536.7198032998,2303488.9331338499,2315647.1021850826,2317974.4538272703,2320108.6005224334,2323480.3906230116,2329191.6581992721,2329469.743980763,2333427.6160336114,2348462.8411788158,2359554.745271367,2362906.3256494529,2369486.6112928726,2374273.0819678959,2384326.2063243543,2386844.337746867,2387199.2204738278,2393220.9093875666,2397503.7537780874,2409343.417602845,2411027.2916808845,2412703.8902588272,2417359.4019321022,2420497.5676406715,2425118.3185912599,2430766.5318333451,2433439.8739245967,2435879.5916238404,2437992.7202076116,2450856.6127682677,2452276.952065011,2453430.5230248589,2454088.5515892007,2468418.0532249822,2507392.0988565008,2537786.7130956831,2540676.7034120499,2553171.9706344507,2567751.2644402343,2567877.3731085849,2568743.966009045,2570285.5636407402,2575296.7664298755,2593466.1153391516,2594340.7921286086,2604203.1367047415,2616383.1322562657,2636267.8824106692,2643839.2528451006,2657205.1549124597,2690231.0750201107,2696791.1509410385,2714741.4264585003,2718559.447231703,2733221.1967052543,2733894.5846586903,2750492.4255469823,2779579.0665464774,2808862.9544374957,2835468.6499038637,2853477.9378110021,2856665.4152424526,2864028.2213407657,2879879.1108857505,2898261.8744645426,2941913.2582696271,3043902.027020338,3153198.6314241835,3300902.6008408694],"mode":"lines","name":"Regression Fitted Line","type":"scatter","line":{"color":"red","dash":"dash"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_lag</span>(<span class="at">ts =</span> ts2, <span class="at">var =</span> <span class="st">"y"</span>, <span class="at">lag =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-abf476c52f67d50328e5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-abf476c52f67d50328e5">{"x":{"visdat":{"1fa41366f853":["function () ","plotlyVisDat"]},"cur_data":"1fa41366f853","attrs":{"1fa41366f853":{"x":{},"y":{},"mode":"markers","name":"Actual","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"1fa41366f853.1":{"x":{},"y":{},"mode":"lines","name":"Regression Fitted Line","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"color":"red","dash":"dash"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"y vs Lag 12","xaxis":{"domain":[0,1],"automargin":true,"title":"Lag 12"},"yaxis":{"domain":[0,1],"automargin":true,"title":"y"},"annotations":[{"x":0.050000000000000003,"y":0.94999999999999996,"xref":"paper","yref":"paper","text":"y = 76472.07 + 0.98*lag12","showarrow":false,"font":{"size":12}},{"x":0.050000000000000003,"y":0.88,"xref":"paper","yref":"paper","text":"Adjusted R² = 0.918","showarrow":false,"font":{"size":12}}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2505011,2156873,2086568,1663832,1385163,1313119,1459919,1528483,1360871,1507428,1561970,1965873,2319273,2090786,2096915,1734549,1470504,1453967,1602849,1582079,1408599,1506936,1766395,2214167,2532736,2346489,2041522,1603853,1379497,1240196,1464704,1512522,1299128,1417234,1616154,2108690,2512844,2358946,1952607,1609746,1441557,1356266,1452339,1445892,1357712,1426546,1647979,2176020,2396713,2094357,2048169,1585188,1386917,1400018,1547608,1555887,1301829,1302758,1529693,2169754,2010926,1999359,1972165,1543302,1390353,1415134,1615241,1607830,1328565,1501925,1622364,1965718,2306943,2403778,1967388,1662412,1414428,1413254,1513157,1741755,1446674,1479110,1681149,2225994,2554281,2335770,2109623,1672724,1430242,1459015,1556011,1531863,1329726,1488645,1714971,2226478,2538368,2162215,1996245,1585512,1353150,1378772,1503321,1578354,1427135,1510867,1619852,2310875,2624217,2312746,1974222,1540128,1465089,1500962,1668244,1718550,1485061,1506234,1809151,2522442,2699039,2285465,2056105,1665278,1509295,1503845,1728010,1727907,1500242,1579772,1860159,2351937,2557465,2319221,1949890,1784460,1703507,1702557,1891318,1832775,1640347,1727393,1989660,2312832,2661816,2371983,2316191,1783603,1572373,1567216,1738157,1739436,1588718,1680814,2118508,2700111,2997145,2556038,2365293,1786764,1636202,1576508,1701744,1751644,1635485,1730740,2167984,2475535,2903574,2730693,2392542,1826933,1678755,1723906,1882675,1867936,1723960,1804380,2064029,2389902,2880714,2459545,2164467,1903501,1785885,1825125,2001036,2023229,1774412,1748897,1979957,2665391,2708217,2161185,2324198,1753578,1710548,1731387,1950510,1904112,1737701,1838965,2155805,2858509,3107734,2507085,2576005,2148089,1855856,1867447,2139037,2100482,1949898,2069201,2488282,2759042,3161732,2783640,2680848,1994279,1912779,1902995,2162450,2197474,1982049,2072599,2535754,2904407,3052335,2809540,2475096,2035122,1861283,1917555,2234989,2173203,1938029,2093493,2215375,2924939,3056278,2850394,2387023,2036708,1882870,2008918,2171329,2188822,1906377,2015381,2427617,2731775,3287895,2793006,2516726,2114010,1995895,2074067,2329216,2306262,2047010,2108275,2502928,3084994,3030057,2702018,2743975,2176612,2065968,2118628,2404122,2409018,2128961,2186224,2558279,2885437,3423098,2698883,2529429,2151137,2087577,2176896,2471981,2453624,2164696],"y":[2319273,2090786,2096915,1734549,1470504,1453967,1602849,1582079,1408599,1506936,1766395,2214167,2532736,2346489,2041522,1603853,1379497,1240196,1464704,1512522,1299128,1417234,1616154,2108690,2512844,2358946,1952607,1609746,1441557,1356266,1452339,1445892,1357712,1426546,1647979,2176020,2396713,2094357,2048169,1585188,1386917,1400018,1547608,1555887,1301829,1302758,1529693,2169754,2010926,1999359,1972165,1543302,1390353,1415134,1615241,1607830,1328565,1501925,1622364,1965718,2306943,2403778,1967388,1662412,1414428,1413254,1513157,1741755,1446674,1479110,1681149,2225994,2554281,2335770,2109623,1672724,1430242,1459015,1556011,1531863,1329726,1488645,1714971,2226478,2538368,2162215,1996245,1585512,1353150,1378772,1503321,1578354,1427135,1510867,1619852,2310875,2624217,2312746,1974222,1540128,1465089,1500962,1668244,1718550,1485061,1506234,1809151,2522442,2699039,2285465,2056105,1665278,1509295,1503845,1728010,1727907,1500242,1579772,1860159,2351937,2557465,2319221,1949890,1784460,1703507,1702557,1891318,1832775,1640347,1727393,1989660,2312832,2661816,2371983,2316191,1783603,1572373,1567216,1738157,1739436,1588718,1680814,2118508,2700111,2997145,2556038,2365293,1786764,1636202,1576508,1701744,1751644,1635485,1730740,2167984,2475535,2903574,2730693,2392542,1826933,1678755,1723906,1882675,1867936,1723960,1804380,2064029,2389902,2880714,2459545,2164467,1903501,1785885,1825125,2001036,2023229,1774412,1748897,1979957,2665391,2708217,2161185,2324198,1753578,1710548,1731387,1950510,1904112,1737701,1838965,2155805,2858509,3107734,2507085,2576005,2148089,1855856,1867447,2139037,2100482,1949898,2069201,2488282,2759042,3161732,2783640,2680848,1994279,1912779,1902995,2162450,2197474,1982049,2072599,2535754,2904407,3052335,2809540,2475096,2035122,1861283,1917555,2234989,2173203,1938029,2093493,2215375,2924939,3056278,2850394,2387023,2036708,1882870,2008918,2171329,2188822,1906377,2015381,2427617,2731775,3287895,2793006,2516726,2114010,1995895,2074067,2329216,2306262,2047010,2108275,2502928,3084994,3030057,2702018,2743975,2176612,2065968,2118628,2404122,2409018,2128961,2186224,2558279,2885437,3423098,2698883,2529429,2151137,2087577,2176896,2471981,2453624,2164696,2175522,2445484,3065386,3605812,2960920,2482984,2123687,2050025,2158141,2441338,2367094,2162772],"mode":"markers","name":"Actual","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1240196,1299128,1301829,1302758,1313119,1328565,1329726,1353150,1356266,1357712,1360871,1378772,1379497,1385163,1386917,1390353,1400018,1408599,1413254,1414428,1415134,1417234,1426546,1427135,1430242,1441557,1445892,1446674,1452339,1453967,1459015,1459919,1464704,1465089,1470504,1479110,1485061,1488645,1500242,1500962,1501925,1503321,1503845,1506234,1506936,1507428,1509295,1510867,1512522,1513157,1528483,1529693,1531863,1540128,1543302,1547608,1555887,1556011,1561970,1567216,1572373,1576508,1578354,1579772,1582079,1585188,1585512,1588718,1602849,1603853,1607830,1609746,1615241,1616154,1619852,1622364,1635485,1636202,1640347,1647979,1662412,1663832,1665278,1668244,1672724,1678755,1680814,1681149,1701744,1702557,1703507,1710548,1714971,1718550,1723906,1723960,1727393,1727907,1728010,1730740,1731387,1734549,1737701,1738157,1739436,1741755,1748897,1751644,1753578,1766395,1774412,1783603,1784460,1785885,1786764,1804380,1809151,1825125,1826933,1832775,1838965,1855856,1860159,1861283,1867447,1867936,1882675,1882870,1891318,1902995,1903501,1904112,1906377,1912779,1917555,1938029,1949890,1949898,1950510,1952607,1965718,1965873,1967388,1972165,1974222,1979957,1982049,1989660,1994279,1995895,1996245,1999359,2001036,2008918,2010926,2015381,2023229,2035122,2036708,2041522,2047010,2048169,2056105,2064029,2065968,2069201,2072599,2074067,2086568,2087577,2090786,2093493,2094357,2096915,2100482,2108275,2108690,2109623,2114010,2118508,2118628,2128961,2139037,2148089,2151137,2155805,2156873,2161185,2162215,2162450,2164467,2164696,2167984,2169754,2171329,2173203,2176020,2176612,2176896,2186224,2188822,2197474,2214167,2215375,2225994,2226478,2234989,2285465,2306262,2306943,2310875,2312746,2312832,2316191,2319221,2319273,2324198,2329216,2335770,2346489,2351937,2358946,2365293,2371983,2387023,2389902,2392542,2396713,2403778,2404122,2409018,2427617,2453624,2459545,2471981,2475096,2475535,2488282,2502928,2505011,2507085,2512844,2516726,2522442,2529429,2532736,2535754,2538368,2554281,2556038,2557465,2558279,2576005,2624217,2661816,2665391,2680848,2698883,2699039,2700111,2702018,2708217,2730693,2731775,2743975,2759042,2783640,2793006,2809540,2850394,2858509,2880714,2885437,2903574,2904407,2924939,2997145,3030057,3052335,3056278,3084994,3107734,3161732,3287895,3423098],"y":[1290023.3739962419,1347689.2632477304,1350332.2342459704,1351241.2753630991,1361379.6768857806,1376493.830917181,1377629.8876846584,1400550.6402439957,1403599.6952719539,1405014.6290236958,1408105.7602282274,1425622.1703872394,1426331.594294579,1431875.8644449036,1433592.1810427979,1436954.3611057198,1446411.7156773556,1454808.3591930519,1459363.3499360385,1460512.1274080612,1461202.9595164498,1463257.8425583986,1472369.7810758399,1472946.12684332,1475986.3752296697,1487058.2807628368,1491300.1464708596,1492065.345775052,1497608.6374096423,1499201.6610250198,1504141.2084515709,1505025.7866753433,1509707.9844637837,1510084.7130214742,1515383.3757224993,1523804.4821315522,1529627.6292661414,1533134.629657734,1544482.4766279627,1545187.0079566308,1546129.3186087245,1547495.3265737533,1548008.0688185061,1550345.7429076566,1551032.660953108,1551514.0906943644,1553340.9795702305,1554879.2063044892,1556498.6498446916,1557120.0073359476,1572116.7394792368,1573300.7435176929,1575424.1226610399,1583511.5552047098,1586617.3641452552,1590830.8528969844,1598931.984660934,1599053.3206119824,1604884.2958724457,1610017.5894143807,1615063.7950559664,1619109.9576171369,1620916.2976625832,1622303.8329737659,1624561.2687727066,1627603.4741905252,1627920.5132884257,1631057.6347324676,1644885.0405733145,1645867.4703705127,1649759.02744567,1651633.8635925148,1657010.8075522808,1657904.1924176614,1661522.7436029597,1663980.7751274242,1676819.8800766671,1677521.4758581324,1681577.4235766456,1689045.455660528,1703168.3732531217,1704557.8655957729,1705972.7993475148,1708875.0770153338,1713258.8275048246,1719160.2558981546,1721175.0197949987,1721502.8225659763,1741655.3541130882,1742450.8874050425,1743380.477352591,1750270.206637525,1754598.1817301628,1758100.2895430841,1763341.2198157876,1763394.0596654378,1766753.3041811569,1767256.2612685673,1767357.0483891962,1770028.3963437297,1770661.4960237967,1773755.5627755309,1776839.8443699228,1777286.0475447457,1778537.5691688661,1780806.7471566182,1787795.3065307124,1790483.2892527282,1792375.7386827897,1804917.3748488172,1812762.1354903902,1821755.6736039859,1822594.261588248,1823988.6465095703,1824848.7618399861,1842086.2950147337,1846754.7935828944,1862385.6039219848,1864154.7603695292,1869871.249289084,1875928.2616841616,1892456.3709515696,1896666.9241560961,1897766.7758414058,1903798.3468273925,1904276.8410214463,1918699.184428724,1918889.9949969051,1927156.4959199447,1938582.6241489141,1939077.7531104505,1939675.6262240841,1941891.9643621859,1948156.4220929269,1952829.8132397591,1972863.9443830254,1984470.119507099,1984477.9476329731,1985076.7992623411,1987128.7467570871,1999958.0665489873,2000109.7364877977,2001592.1878252036,2006266.55748777,2008279.3643531455,2013891.1520891343,2015938.2070052091,2023385.690258672,2027905.4544352249,2029486.7358617913,2029829.2163687828,2032876.3143652724,2034517.2852516288,2042229.9462690766,2044194.8058634733,2048554.0934596076,2056233.4849420905,2067870.9725696603,2069422.8985241987,2074133.4732689329,2079503.5676185589,2080637.6673545679,2088403.1682216658,2096156.9268999523,2098054.2689086851,2101217.8102775519,2104542.8067425718,2105979.2678404674,2118211.6930344682,2119199.0154103381,2122339.0724015827,2124987.9144942281,2125833.3520886297,2128336.3953368706,2131826.7609609803,2139452.3340780791,2139858.4181077974,2140771.3732878631,2145064.1218140679,2149465.485586775,2149582.9074748866,2159693.9105570088,2169553.4350954257,2178410.9595219595,2181393.4754799879,2185961.1869275197,2187006.2417317107,2191225.6015778459,2192233.472784135,2192463.4239816861,2194437.0902176914,2194661.1703208373,2197878.5300550885,2199610.5029047308,2201151.6651861928,2202985.4036721983,2205741.8824956124,2206321.1638102951,2206599.0622788253,2215726.6570480149,2218268.840925626,2226734.9590584552,2243069.3222104791,2244251.369217467,2254642.2277995879,2255115.8294149702,2263443.9768292685,2312835.5370318433,2333185.7287572762,2333852.0979723078,2337699.6218394237,2339530.4247782263,2339614.5771313729,2342901.411482757,2345866.3141575684,2345917.1969757504,2350736.386966987,2355646.5789215104,2362059.7710438594,2372548.4811994066,2377879.4349196623,2384737.8517010999,2390948.4910664563,2397494.7613286646,2412211.6379719549,2415028.7847708934,2417612.0663093431,2421693.4554369473,2428606.6690995037,2428943.2785120895,2433734.0915470328,2451933.5056885593,2477381.7643894935,2483175.5560520547,2495344.3777233288,2498392.4542355528,2498822.0226428933,2511295.1627075225,2525626.5041515138,2527664.7524259803,2529694.1940588383,2535329.4661724493,2539128.0642528515,2544721.2601898895,2551558.1496251733,2554794.1011583754,2557747.261644376,2560305.1017737351,2575876.2226530355,2577595.4747981327,2578991.8167509236,2579788.3285586126,2597133.4984641289,2644309.6990443356,2681100.9121368271,2684599.1058868114,2699724.0235912888,2717371.554858692,2717524.2033132366,2718573.1721803648,2720439.2016856009,2726505.0207222872,2748498.1403655447,2749556.8943900154,2761494.7863480034,2776238.0829161191,2800307.6129474789,2809472.3913145708,2825651.1704648472,2865627.4522723597,2873568.1074558902,2895296.0493351631,2899917.5791480793,2917664.9190203766,2918480.0226270165,2938570.90768287,3009225.6147909435,3041430.5246369522,3063229.898164826,3067088.1857050182,3095187.2435300662,3117438.6913271691,3170276.5839458122,3293729.0645274236,3426027.3273467575],"mode":"lines","name":"Regression Fitted Line","type":"scatter","line":{"color":"red","dash":"dash"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>